<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EcoGenius - S√°ng T·∫°o S·ªë, Ki·∫øn T·∫°o Xanh</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-green: #2E7D32;
            --light-green: #4CAF50;
            --bright-green: #8BC34A;
            --tech-blue: #2196F3;
            --background: #F5F9F5;
            --card-bg: #FFFFFF;
            --text-dark: #333333;
            --text-light: #666666;
            --shadow: 0 4px 12px rgba(46, 125, 50, 0.1);
            --radius: 16px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', sans-serif; }
        body { background: var(--background); color: var(--text-dark); padding: 10px; }
        .container { max-width: 800px; margin: auto; }
        /* ===== C√ÅC L·ªöP ƒêI·ªÄU KHI·ªÇN "TRANG" ===== */
        .screen { display: none; }
        .screen.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        /* ===== HEADER TH·ªêNG NH·∫§T ===== */
        .app-header {
            background: linear-gradient(135deg, var(--primary-green), var(--tech-blue));
            color: white;
            padding: 15px 20px;
            border-radius: var(--radius);
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }
        .logo { font-weight: 700; font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }
        .user-points { background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 20px; font-weight: 600; }
        /* ===== NAVIGATION BAR ===== */
        .nav-bar {
            display: flex;
            justify-content: space-around;
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 10px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            position: sticky; top: 10px; z-index: 100;
        }
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            border-radius: 12px;
            cursor: pointer;
            color: var(--text-light);
            transition: all 0.3s;
            flex: 1;
            text-align: center;
        }
        .nav-item.active, .nav-item:hover {
            background-color: var(--light-green);
            color: white;
            transform: translateY(-2px);
        }
        .nav-icon { font-size: 1.2rem; margin-bottom: 5px; }
        .nav-text { font-size: 0.8rem; font-weight: 500; }
        /* ===== C√ÅC TH√ÄNH PH·∫¶N CHUNG ===== */
        .card { background: var(--card-bg); padding: 20px; border-radius: var(--radius); margin-bottom: 20px; box-shadow: var(--shadow); }
        h2 { color: var(--primary-green); margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid var(--bright-green); }
        .btn {
            display: inline-block;
            background: linear-gradient(to right, var(--light-green), var(--tech-blue));
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .btn:hover { transform: scale(1.05); box-shadow: 0 6px 16px rgba(76, 175, 80, 0.3); }
        .btn-small { padding: 8px 16px; font-size: 0.9rem; }
        .btn-block { display: block; width: 100%; }
        /* ===== M√ÄN H√åNH ƒêƒÇNG K√ù/ƒêƒÇNG NH·∫¨P ===== */
        .auth-card { max-width: 400px; margin: 40px auto; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--primary-green); }
        .form-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        .form-input:focus { outline: none; border-color: var(--light-green); }
        .error-message { color: #f44336; font-size: 0.9rem; margin-top: 5px; display: none; }
        /* ===== M√ÄN H√åNH HOME (DASHBOARD) ===== */
        .welcome-banner {
            background: linear-gradient(90deg, #E8F5E9, #E3F2FD);
            padding: 20px;
            border-radius: var(--radius);
            margin-bottom: 20px;
            text-align: center;
            border-left: 6px solid var(--primary-green);
        }
        .progress-section { text-align: center; }
        .progress-circle {
            position: relative;
            width: 120px; height: 120px;
            margin: 20px auto;
            border-radius: 50%;
            background: conic-gradient(var(--light-green) 0% 75%, #e0e0e0 75% 100%);
            display: flex; align-items: center; justify-content: center;
        }
        .progress-inner {
            width: 90px; height: 90px;
            background: white;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 1.5rem; color: var(--primary-green);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        .stat-item {
            background: #F1F8E9;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }
        .stat-value { font-size: 1.8rem; font-weight: 700; color: var(--primary-green); display: block; }
        .stat-label { font-size: 0.9rem; color: var(--text-light); }
        /* ===== M√ÄN H√åNH DANH S√ÅCH B√ÄI H·ªåC ===== */
        .lesson-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; }
        .lesson-item {
            border-left: 5px solid var(--tech-blue);
            transition: transform 0.3s;
        }
        .lesson-item:hover { transform: translateY(-5px); }
        .lesson-title { font-size: 1.2rem; margin-bottom: 10px; color: var(--text-dark); }
        .lesson-meta { display: flex; justify-content: space-between; color: var(--text-light); font-size: 0.9rem; margin-bottom: 15px; }
        .lesson-status { padding: 3px 10px; border-radius: 15px; font-size: 0.8rem; font-weight: 600; }
        .status-new { background: #FFEBEE; color: #C62828; }
        .status-completed { background: #E8F5E9; color: var(--primary-green); }
        /* ===== M√ÄN H√åNH CHI TI·∫æT B√ÄI H·ªåC ===== */
        .theory-content {
            line-height: 1.8;
            max-height: 50vh;
            overflow-y: auto;
            padding: 15px;
            background: #FAFAFA;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #eee;
        }
        .action-box {
            background: #E8F5E9;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border-left: 4px solid var(--bright-green);
        }
        /* ===== M√ÄN H√åNH QUIZ ===== */
        .quiz-question { margin-bottom: 25px; }
        .quiz-options { display: flex; flex-direction: column; gap: 12px; margin-top: 15px; }
        .quiz-option {
            padding: 15px;
            background: #f9f9f9;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .quiz-option.selected {
            background: #E3F2FD;
            border-color: var(--tech-blue);
            font-weight: 600;
        }
        .quiz-result { text-align: center; padding: 30px; }
        .score-circle {
            width: 100px; height: 100px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--light-green), var(--tech-blue));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 700;
            margin: 20px auto;
        }
        /* ===== M√ÄN H√åNH C·ª¨A H√ÄNG & AVATAR ===== */
        .avatar-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 20px; }
        .avatar-item {
            text-align: center;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: var(--radius);
            cursor: pointer;
            transition: all 0.3s;
        }
        .avatar-item.owned { border-color: var(--bright-green); background: #F1F8E9; }
        .avatar-item.selected { border-color: var(--tech-blue); background: #E3F2FD; transform: scale(1.05); }
        .avatar-icon { font-size: 2.5rem; margin-bottom: 10px; display: block; }
        .avatar-price { color: var(--light-green); font-weight: 600; }
        /* ===== ECOBOT CHAT ===== */
        .chat-container { display: flex; flex-direction: column; height: 60vh; }
        .chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px;
            background: #f0f4f8;
            border-radius: 15px;
            margin-bottom: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .message {
            max-width: 80%;
            padding: 12px 18px;
            border-radius: 18px;
            line-height: 1.4;
        }
        .bot-message { align-self: flex-start; background: white; border-bottom-left-radius: 5px; }
        .user-message { align-self: flex-end; background: linear-gradient(90deg, var(--bright-green), var(--light-green)); color: white; border-bottom-right-radius: 5px; }
        .chat-input-container { display: flex; gap: 10px; }
        #chatInput { flex-grow: 1; padding: 15px; border: 2px solid #e0e0e0; border-radius: 50px; }
        /* ===== RESPONSIVE ===== */
        @media (max-width: 600px) {
            .stats-grid { grid-template-columns: 1fr; }
            .lesson-list { grid-template-columns: 1fr; }
            .nav-text { font-size: 0.7rem; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- KHUNG HEADER HI·ªÇN TH·ªä TR√äN T·∫§T C·∫¢ C√ÅC TRANG -->
        <header class="app-header">
            <div class="logo"><i class="fas fa-seedling"></i> EcoGenius</div>
            <div class="user-points" id="headerPoints">0 ƒêi·ªÉm Xanh</div>
        </header>

        <!-- THANH ƒêI·ªÄU H∆Ø·ªöNG -->
        <nav class="nav-bar">
            <div class="nav-item active" data-target="homeScreen"><i class="fas fa-home nav-icon"></i><span class="nav-text">Trang ch·ªß</span></div>
            <div class="nav-item" data-target="learnScreen"><i class="fas fa-book-open nav-icon"></i><span class="nav-text">H·ªçc t·∫≠p</span></div>
            <div class="nav-item" data-target="storeScreen"><i class="fas fa-store nav-icon"></i><span class="nav-text">C·ª≠a h√†ng</span></div>
            <div class="nav-item" data-target="ecoBotScreen"><i class="fas fa-robot nav-icon"></i><span class="nav-text">Ecobot</span></div>
            <div class="nav-item" data-target="profileScreen"><i class="fas fa-user nav-icon"></i><span class="nav-text">C√° nh√¢n</span></div>
        </nav>

        <!-- C√ÅC M√ÄN H√åNH (SCREEN) C·ª¶A ·ª®NG D·ª§NG -->
        <!-- M√ÄN H√åNH ƒêƒÇNG NH·∫¨P/ƒêƒÇNG K√ù -->
        <section id="authScreen" class="screen active">
            <div class="card auth-card">
                <h2>Ch√†o m·ª´ng ƒë·∫øn v·ªõi EcoGenius!</h2>
                <div class="form-group">
                    <label class="form-label">T√™n ƒëƒÉng nh·∫≠p</label>
                    <input type="text" id="regUsername" class="form-input" placeholder="T·∫°o t√™n ri√™ng cho b·∫°n" minlength="3">
                    <div class="error-message" id="usernameError">T√™n ng∆∞·ªùi d√πng ƒë√£ t·ªìn t·∫°i ho·∫∑c kh√¥ng h·ª£p l·ªá.</div>
                </div>
                <div class="form-group">
                    <label class="form-label">M·∫≠t kh·∫©u (√≠t nh·∫•t 6 k√Ω t·ª±)</label>
                    <input type="password" id="regPassword" class="form-input" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" minlength="6">
                    <div class="error-message" id="passwordError">M·∫≠t kh·∫©u ph·∫£i c√≥ √≠t nh·∫•t 6 k√Ω t·ª±.</div>
                </div>
                <button class="btn btn-block" id="registerBtn">B·∫Øt ƒë·∫ßu H√†nh Tr√¨nh Xanh</button>
                <p style="text-align:center; margin-top:15px; color:var(--text-light)">ƒê√£ c√≥ t√†i kho·∫£n? <a href="#" style="color:var(--tech-blue); font-weight:600" id="switchToLogin">ƒêƒÉng nh·∫≠p</a></p>
            </div>
        </section>

        <!-- M√ÄN H√åNH HOME (DASHBOARD) -->
        <section id="homeScreen" class="screen">
            <div class="welcome-banner">
                <h2>Ch√†o b·∫°n, <span id="userGreeting">Ng∆∞·ªùi Ki·∫øn T·∫°o Xanh!</span></h2>
                <p>H√¥m nay b·∫°n mu·ªën kh√°m ph√° ƒëi·ªÅu g√¨?</p>
            </div>
            <div class="card progress-section">
                <h2><i class="fas fa-chart-line"></i> Ti·∫øn ƒê·ªô C·ªßa B·∫°n</h2>
                <div class="progress-circle"><div class="progress-inner"><span id="progressPercent">0</span>%</div></div>
                <p>B·∫°n ƒë√£ ho√†n th√†nh <strong id="completedLessons">0</strong> tr√™n 10 b√†i h·ªçc.</p>
            </div>
            <div class="card">
                <h2><i class="fas fa-trophy"></i> Th√†nh T√≠ch N·ªïi B·∫≠t</h2>
                <div class="stats-grid">
                    <div class="stat-item"><span class="stat-value" id="totalPoints">0</span><span class="stat-label">ƒêi·ªÉm Xanh</span></div>
                    <div class="stat-item"><span class="stat-value" id="badgeCount">0</span><span class="stat-label">Huy Hi·ªáu</span></div>
                    <div class="stat-item"><span class="stat-value" id="quizDone">0</span><span class="stat-label">Quiz ƒê√£ L√†m</span></div>
                    <div class="stat-item"><span class="stat-value" id="avatarCount">1</span><span class="stat-label">Avatar</span></div>
                </div>
            </div>
            <div class="card">
                <h2><i class="fas fa-rocket"></i> B√†i H·ªçc Ti·∫øp Theo</h2>
                <p><strong id="nextLessonTitle">AI Xanh: Tr√≠ Tu·ªá Nh√¢n T·∫°o V√¨ H√†nh Tinh</strong></p>
                <button class="btn" data-target="learnScreen" onclick="switchScreen('learnScreen')">Ti·∫øp T·ª•c H·ªçc Ngay</button>
            </div>
        </section>

        <!-- M√ÄN H√åNH DANH S√ÅCH B√ÄI H·ªåC -->
        <section id="learnScreen" class="screen">
            <div class="card">
                <h2><i class="fas fa-graduation-cap"></i> H·ªçc T·∫≠p</h2>
                <p>Ch·ªçn m·ªôt b√†i h·ªçc ƒë·ªÉ b·∫Øt ƒë·∫ßu h√†nh tr√¨nh S√°ng T·∫°o S·ªë - Ki·∫øn T·∫°o Xanh c·ªßa b·∫°n.</p>
            </div>
            <div id="lessonListContainer">
                <!-- Danh s√°ch b√†i h·ªçc s·∫Ω ƒë∆∞·ª£c t·∫£i ƒë·ªông b·∫±ng JavaScript -->
            </div>
        </section>

        <!-- M√ÄN H√åNH B√ÄI H·ªåC CHI TI·∫æT -->
        <section id="lessonDetailScreen" class="screen">
            <div class="card">
                <button class="btn-small" onclick="switchScreen('learnScreen')"><i class="fas fa-arrow-left"></i> Quay l·∫°i</button>
                <h2 id="detailLessonTitle">B√†i 1: AI Xanh</h2>
                <div class="theory-content" id="lessonTheoryContent">
                    <!-- N·ªôi dung l√Ω thuy·∫øt s·∫Ω ƒë∆∞·ª£c t·∫£i ƒë·ªông -->
                </div>
                <div class="action-box">
                    <p><i class="fas fa-lightbulb"></i> <strong>H√†nh ƒë·ªông c·ªßa b·∫°n:</strong> H√£y th·ª≠ t·∫Øt ƒë√®n v√† thi·∫øt b·ªã ƒëi·ªán khi kh√¥ng d√πng trong m·ªôt ng√†y.</p>
                </div>
                <button class="btn" id="startQuizBtn">L√†m Quiz Ki·ªÉm Tra Ngay</button>
            </div>
        </section>

        <!-- M√ÄN H√åNH C·ª¨A H√ÄNG AVATAR -->
        <section id="storeScreen" class="screen">
            <div class="card">
                <h2><i class="fas fa-leaf"></i> C·ª≠a H√†ng Xanh</h2>
                <p>D√πng <strong id="storePoints">0</strong> ƒêi·ªÉm Xanh c·ªßa b·∫°n ƒë·ªÉ ƒë·ªïi l·∫•y c√°c avatar ƒë·∫∑c bi·ªát!</p>
                <div class="avatar-grid" id="avatarStoreGrid">
                    <!-- Danh s√°ch avatar s·∫Ω ƒë∆∞·ª£c t·∫£i ƒë·ªông -->
                </div>
            </div>
        </section>

        <!-- M√ÄN H√åNH ECOBOT -->
        <section id="ecoBotScreen" class="screen">
            <div class="card">
                <h2><i class="fas fa-robot"></i> Ecobot - Tr·ª£ L√Ω Xanh</h2>
                <p>T√¥i c√≥ th·ªÉ gi·∫£i ƒë√°p th·∫Øc m·∫Øc v·ªÅ b√†i h·ªçc, m√¥i tr∆∞·ªùng v√† c√¥ng ngh·ªá. H·ªèi t√¥i b·∫•t c·ª© ƒëi·ªÅu g√¨!</p>
            </div>
            <div class="card chat-container">
                <div class="chat-messages" id="chatMessages">
                    <div class="message bot-message">Xin ch√†o! T√¥i l√† Ecobot. B·∫°n mu·ªën t√¨m hi·ªÉu ƒëi·ªÅu g√¨ v·ªÅ S√°ng T·∫°o S·ªë v√† Ki·∫øn T·∫°o Xanh?</div>
                </div>
                <div class="chat-input-container">
                    <input type="text" id="chatInput" class="form-input" placeholder="Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n...">
                    <button class="btn" id="sendMessageBtn"><i class="fas fa-paper-plane"></i></button>
                </div>
            </div>
        </section>

        <!-- M√ÄN H√åNH H·ªí S∆† -->
        <section id="profileScreen" class="screen">
            <div class="card" style="text-align: center;">
                <div style="font-size: 4rem; margin-bottom: 10px;" id="profileAvatar">üå±</div>
                <h2 id="profileUsername">T√™n Ng∆∞·ªùi D√πng</h2>
                <p class="stat-label" id="profileTitle">Ng∆∞·ªùi m·ªõi b·∫Øt ƒë·∫ßu</p>
            </div>
            <div class="card">
                <h2><i class="fas fa-medal"></i> Huy Hi·ªáu C·ªßa B·∫°n</h2>
                <div id="badgeCollection">
                    <!-- Huy hi·ªáu s·∫Ω ƒë∆∞·ª£c t·∫£i ƒë·ªông -->
                </div>
            </div>
            <div class="card">
                <button class="btn btn-block" id="logoutBtn"><i class="fas fa-sign-out-alt"></i> ƒêƒÉng Xu·∫•t</button>
            </div>
        </section>
    </div>

    <script>
        // ===================== C∆† S·ªû D·ªÆ LI·ªÜU & TR·∫†NG TH√ÅI ·ª®NG D·ª§NG =====================
        const APP_STATE = {
            currentUser: null,
            users: JSON.parse(localStorage.getItem('ecogenius_users')) || {},
            lessons: [
                {
                    id: 1,
                    title: "AI Xanh: Tr√≠ Tu·ªá Nh√¢n T·∫°o V√¨ H√†nh Tinh",
                    content: `... (500-600 ch·ªØ v·ªÅ AI Xanh) ...`,
                    completed: false, quizScore: 0
                },
                {
                    id: 2,
                    title: "Th√†nh Ph·ªë Th√¥ng Minh V√† B·ªÅn V·ªØng",
                    content: `... (500-600 ch·ªØ v·ªÅ th√†nh ph·ªë th√¥ng minh) ...`,
                    completed: false, quizScore: 0
                }
                // ... th√™m 8 b√†i h·ªçc kh√°c ...
            ],
            avatars: [
                { id: 1, icon: "üå±", name: "M·∫ßm Xanh", price: 0, owned: true },
                { id: 2, icon: "üåç", name: "Tr√°i ƒê·∫•t", price: 300, owned: false },
                { id: 3, icon: "ü§ñ", name: "Robot Xanh", price: 450, owned: false },
                { id: 4, icon: "‚ôªÔ∏è", name: "T√°i Ch·∫ø", price: 500, owned: false }
            ],
            badges: [
                { id: 1, name: "H·∫°t Gi·ªëng Xanh", desc: "B·∫Øt ƒë·∫ßu h√†nh tr√¨nh", pointsRequired: 50, unlocked: false },
                { id: 2, name: "M·∫ßm S√°ng T·∫°o", desc: "T√≠ch l≈©y 200 ƒëi·ªÉm", pointsRequired: 200, unlocked: false },
                { id: 3, name: "Nh√† C·∫£i C√°ch Xanh", desc: "T√≠ch l≈©y 500 ƒëi·ªÉm", pointsRequired: 500, unlocked: false }
            ],
            ecobotKnowledge: [
                { keywords: ["ch√†o", "hello", "xin ch√†o"], response: "Ch√†o b·∫°n! T√¥i l√† Ecobot. H√£y h·ªèi t√¥i v·ªÅ c√¥ng ngh·ªá xanh, ti·∫øt ki·ªám nƒÉng l∆∞·ª£ng hay b·∫£o v·ªá m√¥i tr∆∞·ªùng!" },
                { keywords: ["AI xanh", "tr√≠ tu·ªá nh√¢n t·∫°o"], response: "AI Xanh l√† ·ª©ng d·ª•ng tr√≠ tu·ªá nh√¢n t·∫°o ƒë·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ m√¥i tr∆∞·ªùng, nh∆∞ t·ªëi ∆∞u h√≥a nƒÉng l∆∞·ª£ng ho·∫∑c d·ª± b√°o thi√™n tai." },
                { keywords: ["t√°i ch·∫ø", "r√°c th·∫£i", "3R"], response: "Nguy√™n t·∫Øc 3R l√† Gi·∫£m thi·ªÉu (Reduce), T√°i s·ª≠ d·ª•ng (Reuse), T√°i ch·∫ø (Recycle). B·∫°n c√≥ th·ªÉ b·∫Øt ƒë·∫ßu b·∫±ng vi·ªác ph√¢n lo·∫°i r√°c t·∫°i nh√†!" },
                { keywords: ["ti·∫øt ki·ªám", "nƒÉng l∆∞·ª£ng"], response: "H√£y t·∫Øt ƒë√®n v√† r√∫t ph√≠ch c·∫Øm thi·∫øt b·ªã khi kh√¥ng d√πng. S·ª≠ d·ª•ng ƒë√®n LED v√† m√°y c√≥ nh√£n ti·∫øt ki·ªám nƒÉng l∆∞·ª£ng." },
                { keywords: ["l√†m sao", "h·ªçc"], response: "H√£y v√†o m·ª•c H·ªçc t·∫≠p, ch·ªçn m·ªôt b√†i v√† ƒë·ªçc k·ªπ l√Ω thuy·∫øt. Sau ƒë√≥ l√†m quiz ƒë·ªÉ ki·ªÉm tra ki·∫øn th·ª©c v√† nh·∫≠n ƒëi·ªÉm nh√©!" }
            ]
        };

        // ===================== H·ªÜ TH·ªêNG ƒêƒÇNG K√ù/ƒêƒÇNG NH·∫¨P =====================
        document.getElementById('registerBtn').onclick = function() {
            const username = document.getElementById('regUsername').value.trim();
            const password = document.getElementById('regPassword').value;
            let valid = true;

            // Validate
            if (username.length < 3) {
                document.getElementById('usernameError').style.display = 'block';
                valid = false;
            } else {
                document.getElementById('usernameError').style.display = 'none';
            }
            if (password.length < 6) {
                document.getElementById('passwordError').style.display = 'block';
                valid = false;
            } else {
                document.getElementById('passwordError').style.display = 'none';
            }
            if (APP_STATE.users[username]) {
                alert("T√™n ƒëƒÉng nh·∫≠p ƒë√£ t·ªìn t·∫°i. Vui l√≤ng ch·ªçn t√™n kh√°c.");
                valid = false;
            }
            if (!valid) return;

            // T·∫°o user m·ªõi
            APP_STATE.users[username] = {
                username: username,
                password: password,
                points: 0,
                completedLessons: [],
                ownedAvatars: [1], // Avatar m·∫∑c ƒë·ªãnh
                currentAvatar: 1,
                unlockedBadges: []
            };
            APP_STATE.currentUser = APP_STATE.users[username];

            // L∆∞u v√†o localStorage
            localStorage.setItem('ecogenius_users', JSON.stringify(APP_STATE.users));
            localStorage.setItem('ecogenius_currentUser', username);

            alert("ƒêƒÉng k√Ω th√†nh c√¥ng! B·∫Øt ƒë·∫ßu h√†nh tr√¨nh c·ªßa b·∫°n n√†o.");
            switchScreen('homeScreen');
            updateUI();
        };

        // ===================== H·ªÜ TH·ªêNG CHUY·ªÇN M√ÄN H√åNH & NAV =====================
        function switchScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.querySelector(`[data-target="${screenId}"]`).classList.add('active');
        }
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function() {
                if (APP_STATE.currentUser || this.dataset.target === 'authScreen') {
                    switchScreen(this.dataset.target);
                } else {
                    alert("Vui l√≤ng ƒëƒÉng nh·∫≠p tr∆∞·ªõc.");
                }
            });
        });

        // ===================== C·∫¨P NH·∫¨T GIAO DI·ªÜN NG∆Ø·ªúI D√ôNG =====================
        function updateUI() {
            if (!APP_STATE.currentUser) return;
            const u = APP_STATE.currentUser;
            // C·∫≠p nh·∫≠t ƒëi·ªÉm tr√™n header
            document.getElementById('headerPoints').textContent = u.points + " ƒêi·ªÉm Xanh";
            // C·∫≠p nh·∫≠t dashboard
            document.getElementById('userGreeting').textContent = u.username;
            document.getElementById('totalPoints').textContent = u.points;
            document.getElementById('completedLessons').textContent = u.completedLessons.length;
            document.getElementById('progressPercent').textContent = (u.completedLessons.length / 10 * 100).toFixed(0);
            // ... (c·∫≠p nh·∫≠t c√°c ph·∫ßn t·ª≠ kh√°c)
            updateBadges();
            updateAvatarStore();
        }

        // ===================== CH·ª®C NƒÇNG B√ÄI H·ªåC =====================
        function loadLessonList() {
            const container = document.getElementById('lessonListContainer');
            container.innerHTML = '';
            APP_STATE.lessons.forEach(lesson => {
                const isCompleted = APP_STATE.currentUser.completedLessons.includes(lesson.id);
                const div = document.createElement('div');
                div.className = 'card lesson-item';
                div.innerHTML = `
                    <h3 class="lesson-title">B√†i ${lesson.id}: ${lesson.title}</h3>
                    <div class="lesson-meta">
                        <span><i class="far fa-file-alt"></i> L√Ω thuy·∫øt</span>
                        <span class="lesson-status ${isCompleted ? 'status-completed' : 'status-new'}">
                            ${isCompleted ? 'ƒê√£ ho√†n th√†nh' : 'M·ªõi'}
                        </span>
                    </div>
                    <button class="btn btn-small" onclick="openLessonDetail(${lesson.id})">
                        ${isCompleted ? '√în T·∫≠p L·∫°i' : 'B·∫Øt ƒê·∫ßu H·ªçc'}
                    </button>
                `;
                container.appendChild(div);
            });
        }
        function openLessonDetail(lessonId) {
            const lesson = APP_STATE.lessons.find(l => l.id === lessonId);
            document.getElementById('detailLessonTitle').textContent = `B√†i ${lesson.id}: ${lesson.title}`;
            document.getElementById('lessonTheoryContent').innerHTML = `<p>${lesson.content}</p>`;
            // G√°n s·ª± ki·ªán cho n√∫t l√†m quiz
            document.getElementById('startQuizBtn').onclick = function() { startQuiz(lessonId); };
            switchScreen('lessonDetailScreen');
        }

        // ===================== CH·ª®C NƒÇNG QUIZ (M·∫™U) =====================
        function startQuiz(lessonId) {
            alert(`B·∫Øt ƒë·∫ßu quiz cho b√†i ${lessonId}! (Ch·ª©c nƒÉng ƒë·∫ßy ƒë·ªß c·∫ßn ph√°t tri·ªÉn th√™m c√¢u h·ªèi chi ti·∫øt)`);
            // Gi·∫£ l·∫≠p ho√†n th√†nh quiz v√† c·ªông ƒëi·ªÉm
            const user = APP_STATE.currentUser;
            if (!user.completedLessons.includes(lessonId)) {
                user.completedLessons.push(lessonId);
                user.points += 120; // ƒêi·ªÉm l√Ω thuy·∫øt + quiz
            }
            // L∆∞u v√† c·∫≠p nh·∫≠t
            APP_STATE.users[user.username] = user;
            localStorage.setItem('ecogenius_users', JSON.stringify(APP_STATE.users));
            updateUI();
            switchScreen('homeScreen');
            alert(`Ch√∫c m·ª´ng! B·∫°n ƒë√£ ho√†n th√†nh b√†i h·ªçc v√† nh·∫≠n ƒë∆∞·ª£c 120 ƒêi·ªÉm Xanh!`);
        }

        // ===================== CH·ª®C NƒÇNG C·ª¨A H√ÄNG AVATAR =====================
        function updateAvatarStore() {
            const grid = document.getElementById('avatarStoreGrid');
            grid.innerHTML = '';
            APP_STATE.avatars.forEach(avatar => {
                const isOwned = APP_STATE.currentUser.ownedAvatars.includes(avatar.id);
                const isSelected = APP_STATE.currentUser.currentAvatar === avatar.id;
                const div = document.createElement('div');
                div.className = `avatar-item ${isOwned ? 'owned' : ''} ${isSelected ? 'selected' : ''}`;
                div.innerHTML = `
                    <span class="avatar-icon">${avatar.icon}</span>
                    <div>${avatar.name}</div>
                    ${isOwned ?
                        `<div style="color:var(--tech-blue); font-size:0.9rem;">ƒê√£ s·ªü h·ªØu</div>` :
                        `<div class="avatar-price">${avatar.price} ƒëi·ªÉm</div>
                         <button class="btn-small" onclick="buyAvatar(${avatar.id})" ${APP_STATE.currentUser.points >= avatar.price ? '' : 'disabled'}>Mua</button>`
                    }
                `;
                if (isOwned && !isSelected) {
                    const selectBtn = document.createElement('button');
                    selectBtn.className = 'btn-small';
                    selectBtn.textContent = 'Ch·ªçn';
                    selectBtn.onclick = () => selectAvatar(avatar.id);
                    div.appendChild(selectBtn);
                }
                grid.appendChild(div);
            });
            document.getElementById('storePoints').textContent = APP_STATE.currentUser.points;
        }
        function buyAvatar(avatarId) {
            const avatar = APP_STATE.avatars.find(a => a.id === avatarId);
            const user = APP_STATE.currentUser;
            if (user.points >= avatar.price) {
                user.points -= avatar.price;
                user.ownedAvatars.push(avatarId);
                user.currentAvatar = avatarId;
                APP_STATE.users[user.username] = user;
                localStorage.setItem('ecogenius_users', JSON.stringify(APP_STATE.users));
                updateUI();
                updateAvatarStore();
                alert(`B·∫°n ƒë√£ mua avatar ${avatar.name} th√†nh c√¥ng!`);
            } else {
                alert("B·∫°n kh√¥ng c√≥ ƒë·ªß ƒêi·ªÉm Xanh.");
            }
        }

        // ===================== CHATBOT ECOBOT =====================
        document.getElementById('sendMessageBtn').onclick = sendMessage;
        document.getElementById('chatInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') sendMessage();
        });
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const userText = input.value.trim();
            if (!userText) return;

            // Hi·ªÉn th·ªã tin nh·∫Øn ng∆∞·ªùi d√πng
            const userMsg = document.createElement('div');
            userMsg.className = 'message user-message';
            userMsg.textContent = userText;
            document.getElementById('chatMessages').appendChild(userMsg);

            // T√¨m c√¢u tr·∫£ l·ªùi
            let botResponse = "T√¥i ch∆∞a hi·ªÉu c√¢u h·ªèi c·ªßa b·∫°n. H√£y h·ªèi v·ªÅ c√¥ng ngh·ªá xanh, m√¥i tr∆∞·ªùng ho·∫∑c b√†i h·ªçc nh√©!";
            const lowerText = userText.toLowerCase();
            for (const item of APP_STATE.ecobotKnowledge) {
                if (item.keywords.some(keyword => lowerText.includes(keyword))) {
                    botResponse = item.response;
                    break;
                }
            }

            // Hi·ªÉn th·ªã ph·∫£n h·ªìi c·ªßa bot (c√≥ ƒë·ªô tr·ªÖ gi·∫£ l·∫≠p)
            setTimeout(() => {
                const botMsg = document.createElement('div');
                botMsg.className = 'message bot-message';
                botMsg.textContent = botResponse;
                document.getElementById('chatMessages').appendChild(botMsg);
                document.getElementById('chatMessages').scrollTop = document.getElementById('chatMessages').scrollHeight;
            }, 500);

            input.value = '';
            input.focus();
        }

        // ===================== KH·ªûI T·∫†O ·ª®NG D·ª§NG =====================
        function initApp() {
            const savedUser = localStorage.getItem('ecogenius_currentUser');
            if (savedUser && APP_STATE.users[savedUser]) {
                APP_STATE.currentUser = APP_STATE.users[savedUser];
                switchScreen('homeScreen');
                updateUI();
                loadLessonList();
            } else {
                switchScreen('authScreen');
            }
        }
        window.onload = initApp;
    </script>
</body>
</html>